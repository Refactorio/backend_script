if [ -z "$folder" ]; then
    echo "Missing argument: folder, this is plague's fault."
    exit 1
fi
if [ -z "$repository" ]; then
    echo "Missing argument: repository, this is plague's fault."
    exit 1
fi
if [ -z "$branch" ]; then
    echo "Missing argument: branch, this is plague's fault."
    exit 1
fi
if [ -z "$map" ]; then
    echo "Missing argument: map, this is plague's fault."
    exit 1
fi

git --git-dir=/factorio/scenarios/"$folder"/.git/ --work-tree=/factorio/scenarios/"$folder"/ fetch "$repository"
git --git-dir=/factorio/scenarios/"$folder"/.git/ --work-tree=/factorio/scenarios/"$folder"/ reset --hard "$repository/$branch"

if [ -z "$cleanup" ]; then
    echo "Deleting "
    rm /factorio/scenarios/"$folder"/map_gen/data/.map_previews -rf
fi

rm /factorio/scenarios/"$folder"/map_gen/data/.map_previews -rf
rm /factorio/scenarios/"$folder"/redmew_git_banner.png

if [ -z "$debug" ]; then
    echo "Setting up without debug"
    echo "return require 'map_gen.maps.$map'" >>/factorio/scenarios/"$folder"/map_selection.lua
else
    echo "Setting up with debug"
    echo '_DEBUG = true' >/factorio/scenarios/"$folder"/map_selection.lua
    echo '_CHEATS = true' >>/factorio/scenarios/"$folder"/map_selection.lua
    echo "return require 'map_gen.maps.$map'" >>/factorio/scenarios/"$folder"/map_selection.lua
fi

touch /factorio/scenarios/"$folder"

exit 0
